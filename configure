#!/bin/bash

HELP_MSG="Usage: $0 [options]
Options: [defaults in brackets after descriptions]

Standard options:
  --help                   print this message
  --devmode                enables extra utilities for development on foxstd
  --prefix PREFIX          install in PREFIX [/usr/local]

Advanced options (experts only):
  --cc CC                  use C compiler CC [gcc]
  --ar AR                  create archives using AR [ar]
  --extra-cflags FLAGS     specify compiler flags [-Wall -g -O2]
  --extra-ldflags FLAGS    specify linker options []
  --strip-binaries         strip symbol tables from resulting binaries
  --enable-static          enable generation of static libraries"

DEVMODE=false
PREFIX="/usr/local"
CC="gcc"
AR="ar"
STRIP_BINARIES=false
EXTRA_CFLAGS=("-Wall" "-O2")
EXTRA_LDFLAGS=("")
STATIC=false

# parse args

while [[ $# -gt 0 ]]; do
    case $1 in
        --help)
            echo "$HELP_MSG"
            exit 0
            ;;
        --devmode)
            DEVMODE=true
            shift
            ;;
        --prefix)
            PREFIX="$2"
            shift
            shift
            ;;
        --cc)
            CC="$2"
            shift
            shift
            ;;
        --ar)
            AR="$2"
            shift
            shift
            ;;
        --extra-cflags)
            EXTRA_CFLAGS=()
            for i in $2; do
                EXTRA_CFLAGS+=("$i")
            done
            shift
            shift
            ;;
        --extra-ldflags)
            EXTRA_LDLAGS=()
            for i in $2; do
                EXTRA_LDLAGS+=("$i")
            done
            shift
            shift
            ;;
        --strip-binaries)
            STRIP_BINARIES=true
            shift
            ;;
        --enable-static)
            STATIC=true
            shift
            ;;
        *)
            echo Invalid option \""$1"\"
            echo "$HELP_MSG"
            exit 1
    esac
done


if [ $STRIP_BINARIES == false ]; then
    EXTRA_CFLAGS+=("-g")
fi

printf "Devmode:\t%s
Prefix:\t\t%s
CC:\t\t%s
AR:\t\t%s
Strip:\t\t%s
CFlags:\t\t%s
LDFlags:\t%s
Static:\t\t%s
" $DEVMODE "$PREFIX" "$CC" "$AR" $STRIP_BINARIES "${EXTRA_CFLAGS[*]}" "${EXTRA_LDFLAGS[*]}" $STATIC
